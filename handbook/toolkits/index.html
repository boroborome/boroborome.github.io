<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>toolkits | Hello Happy3w</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.3648f115.js" as="script"><link rel="preload" href="/assets/js/2.ea5800c7.js" as="script"><link rel="preload" href="/assets/js/13.b8edde7e.js" as="script"><link rel="prefetch" href="/assets/js/10.8b96c1cc.js"><link rel="prefetch" href="/assets/js/11.d64b6e9f.js"><link rel="prefetch" href="/assets/js/12.59b41936.js"><link rel="prefetch" href="/assets/js/3.a969e1d2.js"><link rel="prefetch" href="/assets/js/4.08d94035.js"><link rel="prefetch" href="/assets/js/5.b3c393a9.js"><link rel="prefetch" href="/assets/js/6.269a2766.js"><link rel="prefetch" href="/assets/js/7.eb9feba6.js"><link rel="prefetch" href="/assets/js/8.e342df7d.js"><link rel="prefetch" href="/assets/js/9.d8cce6b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello Happy3w</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/handbook/" class="nav-link router-link-active">
  手册
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/handbook/" class="nav-link router-link-active">
  手册
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/handbook/" aria-current="page" class="sidebar-link">手册概览</a></li><li><a href="/handbook/toolkits/" aria-current="page" class="active sidebar-link">toolkits</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handbook/toolkits/#quick-start" class="sidebar-link">Quick Start</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handbook/toolkits/#maven-gradle-configuration" class="sidebar-link">Maven/Gradle configuration</a></li></ul></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#组件介绍" class="sidebar-link">组件介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handbook/toolkits/#typeconverter" class="sidebar-link">TypeConverter</a></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#messagerecorder-组件" class="sidebar-link">MessageRecorder 组件</a></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#combination-组件" class="sidebar-link">combination 组件</a></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#easyiterator-组件" class="sidebar-link">EasyIterator 组件</a></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#utils-组件" class="sidebar-link">utils 组件</a></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#其他" class="sidebar-link">其他</a></li></ul></li><li class="sidebar-sub-header"><a href="/handbook/toolkits/#version-logs" class="sidebar-link">Version Logs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/handbook/toolkits/#_0-0-6" class="sidebar-link">0.0.6</a></li></ul></li></ul></li><li><a href="/handbook/persistence-core/" class="sidebar-link">persistence-core</a></li><li><a href="/handbook/persistence-jpa/" class="sidebar-link">persistence-jpa</a></li><li><a href="/handbook/persistence-es/" class="sidebar-link">persistence-es</a></li><li><a href="/handbook/persistence-excel/" class="sidebar-link">persistence-excel</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="toolkits"><a href="#toolkits" class="header-anchor">#</a> toolkits</h1> <h2 id="quick-start"><a href="#quick-start" class="header-anchor">#</a> Quick Start</h2> <hr> <h3 id="maven-gradle-configuration"><a href="#maven-gradle-configuration" class="header-anchor">#</a> Maven/Gradle configuration</h3> <p>Add the Maven dependency:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.happy3w<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>toolkits<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Add the Gradle dependency:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>implementation <span class="token string">'com.happy3w:toolkits:0.0.6'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="组件介绍"><a href="#组件介绍" class="header-anchor">#</a> 组件介绍</h2> <h3 id="typeconverter"><a href="#typeconverter" class="header-anchor">#</a> TypeConverter</h3> <p>这是一个负责转换常用数据类型的工具。当前支持的类型有Boolean,Date,Double,Enum,Integer,Long,String.TypeConverter是线程安全的数据转换器。</p> <h4 id="一般用法"><a href="#一般用法" class="header-anchor">#</a> 一般用法</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Date</span> d1 <span class="token operator">=</span> <span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">&quot;2019-09-01 12:00:00&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Date</span> d2 <span class="token operator">=</span> <span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token number">1567310400000l</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面代码得到的两个日期是一样的。</p> <h4 id="调整配置"><a href="#调整配置" class="header-anchor">#</a> 调整配置</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE
    <span class="token punctuation">.</span><span class="token function">findTci</span><span class="token punctuation">(</span><span class="token class-name">DateStrBiTci</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>            <span class="token comment">// 找到时间与字符串之间的双向TypeConvertItem</span>
    <span class="token punctuation">.</span><span class="token function">appendConfig</span><span class="token punctuation">(</span><span class="token string">&quot;MM/dd/yyyy HH:mm:ss&quot;</span><span class="token punctuation">)</span>    <span class="token comment">// 支持解析这种格式</span>
    <span class="token punctuation">.</span><span class="token function">defaultConfig</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 支持解析这种格式，同时配置时间转换成字符串使用这个格式</span>

<span class="token class-name">Date</span> d1 <span class="token operator">=</span> <span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">&quot;2019-09-01 12:00:00&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Date</span> d2 <span class="token operator">=</span> <span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">&quot;09/01/2019 12:00:00&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;2019-09-01 12:00:00&quot;</span><span class="token punctuation">,</span> <span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE
    <span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>d2<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="定制自己的转换规则"><a href="#定制自己的转换规则" class="header-anchor">#</a> 定制自己的转换规则</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TypeConverter</span><span class="token punctuation">.</span>INSTANCE
    <span class="token punctuation">.</span><span class="token function">regist</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ITypeConvertItem</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SourceType</span><span class="token punctuation">,</span> <span class="token class-name">TargetType</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ITypeConvertItem类型仅仅负责数据的单向转换，如果要做双向转换需要实现接口IBiTypeConvertItem，他们都有对应的抽象类AbstractTci和AbstractBiTci。</p> <h4 id="转换规则自动发现"><a href="#转换规则自动发现" class="header-anchor">#</a> 转换规则自动发现</h4> <p>这个工具提供了自动发现转换规则能力，比如在注册了Long与Date的相互转换，注册了Date和String的相互转换后，这个工具也可以完成Long和String的相互转换。这个工具会在已经有的转换规则中找到一条最短路径尝试转换。所以Long到String的转换是先把Long转换为Date，再把Date转换为String，Long会当做一个时间戳转换为String。</p> <p>如果这个不是你期望的结果，那么直接注册一个Long和String的TypeConvertItem，系统会使用你注册的这个最短路径。</p> <h4 id="多个转换器并存"><a href="#多个转换器并存" class="header-anchor">#</a> 多个转换器并存</h4> <p>TypeConverter是一个可以随意实例化的对象，所以可以创建多个TypeConverter，分别使用不同的转换规则。直接new出来的TypeConverter不包含任何规则，通过TypeConverter.INSTANCE.newCopy()得到新的TypeConverter是复制了转换规则的转换器。转换规则是通过引用到新的转换器的，因此配置变化会在两个TypeConverter上生效，如果想要在一个转换器上面生效，还是需要通过重新注册规则的方式操作。</p> <p><em><strong>注意</strong></em>
类似日期格式&quot;yyyy-MM-dd&quot;和&quot;MM-dd-yyyy&quot;不能同时设置，由于SimpleDateFormat在解析的时候没有检测具体数字位数，所以可能会解析结果错误。</p> <h3 id="messagerecorder-组件"><a href="#messagerecorder-组件" class="header-anchor">#</a> MessageRecorder 组件</h3> <p>这个组件负责在处理一个逻辑的过程中收集各种信息，最终可以将收集内容以Map的形式当做Response返回到client。一般的使用流程如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 1、Controller中接收到请求，调用Service功能后返回结果
 * 这是一个上传学生信息的样例
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/_cmd/upload&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadData</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageRecorder</span> messageRecorder <span class="token operator">=</span> studentService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ignoreWarning<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> messageRecorder<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 将返回的消息信息转换为Response。出错时的状态码为200，Http的状态码仅用于表示链路状态，不要用于表示业务信息。</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 2、Service将接收到的文件解析，遇到的问题记录在MessageRecoder中，
 * 最后根据messageRecorder.isSuccess()决定是否入库。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageRecorder</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">MessageRecorder</span> messageRecorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         
         <span class="token comment">// 解析文件</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token comment">// 过程中遇到问题，可以使用下面代码记录下来，可以记录Error，也可以记录Warning，还可以仅仅是一个提示信息info</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             messageRecorder<span class="token punctuation">.</span><span class="token function">appendError</span><span class="token punctuation">(</span><span class="token string">&quot;Age is too small. current age is:{0}&quot;</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             
         <span class="token punctuation">}</span>
         
         <span class="token comment">// 最后根据解析结果决定是否要继续处理</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>messageRecorder<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token function">saveAllData</span><span class="token punctuation">(</span>allStudents<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> messageRecorder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>对于某些出错就想抛出异常，但是接口是MessageRecorder的场景，可以使用MessageRecorder.errorExceptionRecorder()作为参数。
对于想要收集某一段操作都有哪些问题的场景，可以使用下面代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MessageRecorder</span> messageRecorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageRecorder</span><span class="token punctuation">(</span>ignoreWarning<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">MessageFilter</span> filter <span class="token operator">=</span>  messageRecorder<span class="token punctuation">.</span><span class="token function">startErrorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 一段业务逻辑</span>
<span class="token class-name">String</span> errors <span class="token operator">=</span> filter<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 得到过程中所有error消息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="combination-组件"><a href="#combination-组件" class="header-anchor">#</a> combination 组件</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DimCombineDetail</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> details <span class="token operator">=</span> <span class="token class-name">DimCombinationGenerator</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">dimension</span><span class="token punctuation">(</span><span class="token string">&quot;d1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>          <span class="token comment">// 配置维度d1，名称不可省略，不可为空</span>
        <span class="token punctuation">.</span><span class="token function">dimension</span><span class="token punctuation">(</span><span class="token string">&quot;d2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d2v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d2v2&quot;</span><span class="token punctuation">)</span>    <span class="token comment">// 配置维度d2</span>
        <span class="token punctuation">.</span><span class="token function">withNullDimension</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token comment">// 排列组合时，各个维度都增加null值</span>
        <span class="token punctuation">.</span><span class="token function">withOverRelation</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>             <span class="token comment">// 结果中增加over关系的计算</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">generateDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                   <span class="token comment">// 枚举所有结果</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">&gt;</span></span> configMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyConfig</span><span class="token punctuation">&gt;</span></span> myConfigs <span class="token operator">=</span> details<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token function">createConfig</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> configMap<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 将返回结果映射为自己的配置信息</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> myConfigs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
                <span class="token string">&quot;[[d1:null, d2:d2v1], [d1:1, d2:null], [d1:null, d2:null]]&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;[[d1:1, d2:null], [d1:null, d2:d2v1], [d1:null, d2:null]]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>
                configMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;[d1:1, d2:d2v1]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subConfigs<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Over关系：一个排列组合的结果如果完整的包含了另一个结果，则认为是Over。举例子如下</p> <p>有如下数据</p> <ul><li>a: [{'key': 'd1', 'value': 'd1v1'}, {'key': 'd2', 'value': 'd2v1'}]</li> <li>b: [{'key': 'd1', 'value': 'd1v1'}, {'key': 'd2', 'value': null}]</li> <li>c: [{'key': 'd1', 'value': 'd1v2'}, {'key': 'd2', 'value': null}]</li></ul> <p>此时Over关系如下</p> <ul><li>a.isOver(b) == true</li> <li>a.isOver(c) == false</li> <li>a.isOver(a) == false</li></ul> <h3 id="easyiterator-组件"><a href="#easyiterator-组件" class="header-anchor">#</a> EasyIterator 组件</h3> <p>功能类似Stream，但是增加入了如下能力：</p> <ul><li>对排序后数据进行流式group的能力</li> <li>对流进行split</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> studentSteam <span class="token operator">=</span> studentyRepository<span class="token punctuation">.</span><span class="token function">queryAllByXxxOrderByGrade</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 获得准备处理的数据</span>
<span class="token class-name">EasyIterator</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>studentStream<span class="token punctuation">)</span>                                                    <span class="token comment">// 通过from方法创建一个EasyIterator。输入参数可以是Stream,Iterator</span>
    <span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token operator">::</span><span class="token function">getGrade</span><span class="token punctuation">)</span>                                                     <span class="token comment">// 按照某个属性分组。groupBy要求之前数据已经按照这个Key排序了，groupBy得到的结果也不是一个Map，而是一个Map.Entry的EasyIterator</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>gradeStudentEntry <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                                                     <span class="token comment">// EasyIterator和Stream一样支持map,filter,flatMap,forEach等操作</span>
        <span class="token keyword">int</span> grade <span class="token operator">=</span> gradeStudentEntry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                     <span class="token comment">// 前面groupBy后的entry.getKey()内容为计算的Key值</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> gradeStudentEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// 前面groupBy后的entry.getValue()内容为连续符合Key值的value列表。</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>                                                                    <span class="token comment">// 限制最多输出5000条记录</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>                                                                    <span class="token comment">// 在Stream的基础上增加了split方法，通过这个方法将数据分组处理</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">indexed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                      <span class="token comment">// 将数据包装成带有索引的数据</span>
    <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                      <span class="token comment">// 直接转换为List</span>
<span class="token comment">//  .toMap(v -&gt; createKey(v));                                                      // 生成一个key,value的map，这里没有检测重复key，如果key重复最后一个出现的生效</span>
<span class="token comment">//  .toMapList(v -&gt; createKey(v));                                                  // 生成一个key,List&lt;value&gt;的map，key相同的value分组到一个列表中了</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="utils-组件"><a href="#utils-组件" class="header-anchor">#</a> utils 组件</h3> <p>各种常用小工具的集合</p> <ul><li>StreamUtils 在Stream上操作的工具
<ul><li>split 将Stream分成指定大小的块</li> <li>groupBy 将已经排好序的Stream分组，类似EasyIterator.groupBy</li></ul></li> <li>ListUtils 在Collection上操作的工具
<ul><li>fixSizeList 初始化一个固定大小的集合</li> <li>toMap 将集合转换为map</li> <li>subList 更安全的获取一个集合的子集，如果索引越界则直接忽略错误的部分</li> <li>newList 在已有的集合基础上增加新的数据，得到一个新的集合</li></ul></li> <li>MapUtils 在Map上操作的工具
<ul><li>safeRead 在map中读取一个数据，如果没有按照指定逻辑创建一个</li> <li>findByType 如果Map中key为Class类型，则建议使用这个方法查找Map，这个方法会检索集成关系</li></ul></li> <li>TypeDescription 用于程序中创建一个具有泛型信息的Type。比如new TypeDescription(List.class, new Type[]{String.class}).toRealType(),得到了一个List&lt;String&gt;的Type类型。可以用于JSON转换等需要泛型的场景。</li> <li>ZoneIdCache 获得ZoneId的逻辑，他会缓存结果提升转换效率</li> <li>MapBuilder 协助创建一个Map</li> <li>Pair 提供key，value的组合，辅助计算</li> <li>SqlBuilder 辅助创建sql，同时搜索参数</li> <li>StepAction 固定步数执行指定操作的工具。可以执行类似每处理10000条记录就打印一条日志，这样的工作</li> <li>...</li></ul> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <h4 id="原来的simpleconverter变成了typeconverter-使用方法类似"><a href="#原来的simpleconverter变成了typeconverter-使用方法类似" class="header-anchor">#</a> 原来的SimpleConverter变成了TypeConverter，使用方法类似</h4> <h2 id="version-logs"><a href="#version-logs" class="header-anchor">#</a> Version Logs</h2> <h3 id="_0-0-6"><a href="#_0-0-6" class="header-anchor">#</a> 0.0.6</h3> <ul><li>修复TypeConverter中bugs</li> <li>强化EasyIterator</li> <li>实现根据类型管理信息的ConfigManager</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/handbook/" class="prev router-link-active">
        手册概览
      </a></span> <span class="next"><a href="/handbook/persistence-core/">
        persistence-core
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3648f115.js" defer></script><script src="/assets/js/2.ea5800c7.js" defer></script><script src="/assets/js/13.b8edde7e.js" defer></script>
  </body>
</html>
